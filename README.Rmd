---
title: deltamapr
output: 
  github_document:
    toc: true
    toc_depth: 2
editor_options: 
  chunk_output_type: console
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```


<!-- badges: start -->
[![R-CMD-check](https://github.com/InteragencyEcologicalProgram/deltamapr/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/InteragencyEcologicalProgram/deltamapr/actions/workflows/R-CMD-check.yaml)
<!-- badges: end -->

The goal of deltamapr is to provide spatial data for the Bay-Delta.

## Installation

You can install the latest version from R-universe with:

``` r
options(repos = c(
    sbashevkin = 'https://sbashevkin.r-universe.dev',
    CRAN = 'https://cloud.r-project.org'))

install.packages("deltamapr")
```

Or from GitHub with:

``` r
# install.packages("devtools")
devtools::install_github("InteragencyEcologicalProgram/deltamapr")
```

## Usage

This package contains data objects stored in [`sf`](https://r-spatial.github.io/sf/) format, which can be accessed with:
```{r}
require(sf) # To ensure `sf` objects print correctly
deltamapr::WW_Delta
```

Or, after loading the package, like this:

```{r}
require(deltamapr)
WW_Delta
```

## Data types

Four spatial data types are included in this package

1) **Waterways**: Shapefiles of water coverage. These data files are preceded by the prefix *WW*.
2) **Regions**: Shapefiles with sets of regions, subregions, or strata. These data files are preceded by the prefix *R*.
3) **Habitat**: Shapefiles with habitat data. These data files are preceded by the prefix *H*.
4) **Stations**: Shapefile with data on most IEP long-term monitoring programs.These data files are preceded by the prefix *P*.

# Waterways

```{r, message=FALSE}
require(ggplot2)
require(sf)
```

## Delta waterways

Supplied by the California Department of Fish and Wildlife and created by the USBR MPGIS Service Center via digitizing from 7.5 minute USGS quat sheets.

```{r WWDelta}
ggplot(WW_Delta)+
  geom_sf()+
  theme_bw()
```

## DBW waterways

Produced by the California State Parks Division of Boating and Waterways

```{r WWDBW}
ggplot(WW_DBW)+
  geom_sf()+
  theme_bw()
```

## Full watershed waterways

This shapefile includes data from CH2M Hill, and Wetland and Water Resources, CDFG Ecosystem Restoration Program as a part of ERP Stage 2 conservation strategy, and Dan Gillenwater.

```{r WWWatershed}
ggplot(WW_Watershed)+
  geom_sf()+
  theme_bw()
```

# Regions

Most regions are derived from the united States Fish and Wildlife Service [Enhanced Delta Smelt Monitoring Program](https://www.fws.gov/lodi/juvenile_fish_monitoring_program/jfmp_index.htm) (EDSM).

## Regions

### Legal Delta Boundary

The legal Delta boundary as [published](https://data.cnra.ca.gov/dataset/i03-legaldeltaboundary1) by the California Department of Water Resources

```{r}
ggplot(R_Delta)+
  geom_sf(fill="darkorchid4")+
  theme_bw()
```

### Suisun Marsh Boundary

The Suisun Marsh boundary as [published](https://data.cnra.ca.gov/dataset/i03-suisunmarshboundary1) by the California Department of Water Resources

```{r}
ggplot(R_Suisun)+
  geom_sf(aes(fill=LOCATION))+
  theme_bw()+
  theme(legend.position="none")
```

### EDSM 2016-17 Phase 1 Regions (Equivalent to 2017 Phases 2&3 Regions.)

```{r REDSMRegions1617P1}
ggplot(R_EDSM_Regions_1617P1)+
  geom_sf(aes(fill=Region))+
  theme_bw()
```

### EDSM 2017-18 Phase 1 Regions

```{r REDSMRegions1718P1}
ggplot(R_EDSM_Regions_1718P1)+
  geom_sf(aes(fill=Region))+
  theme_bw()
```

### EDSM 2018 Phases 2-3 Regions (Equivalent to 2019 Phase 2 and 2020 Phase 2-3 Regions)

```{r REDSMRegions18P23}
ggplot(R_EDSM_Regions_18P23)+
  geom_sf(aes(fill=Region))+
  theme_bw()+
  theme()
```

### EDSM 2018-19 Phase 1 Regions (Equivalent to 2019-2020 Phase 1 Regions)

```{r REDSMRegions1819P1}
ggplot(R_EDSM_Regions_1819P1)+
  geom_sf(aes(fill=Region))+
  theme_bw()
```

### EDSM 2019 Phase 3 Regions

```{r REDSMRegions19P3}
ggplot(R_EDSM_Regions_19P3)+
  geom_sf(aes(fill=Region))+
  theme_bw()
```

## Strata

### EDSM 2016-17 Phase 1 Strata

```{r REDSMStrata1617P1}
ggplot(R_EDSM_Strata_1617P1)+
  geom_sf(aes(fill=Stratum))+
  theme_bw()+
  theme()
```

### EDSM 2017 Phase 2 Strata

```{r REDSMStrata17P2}
ggplot(R_EDSM_Strata_17P2)+
  geom_sf(aes(fill=Stratum))+
  theme_bw()
```

### EDSM 2017 Phase 3 Strata

```{r REDSMStrata17P3}
ggplot(R_EDSM_Strata_17P3)+
  geom_sf(aes(fill=Stratum))+
  theme_bw()
```

### EDSM 2017-18 Phase 1 Strata

```{r REDSMStrata1718P1}
ggplot(R_EDSM_Strata_1718P1)+
  geom_sf(aes(fill=Stratum))+
  theme_bw()
```

### EDSM 2018 Phases 2-3 Strata (Equivalent to 2019 Phase 2 and 2020 Phase 2-3 Strata)

```{r REDSMStrata18P23}
ggplot(R_EDSM_Strata_18P23)+
  geom_sf(aes(fill=Stratum))+
  theme_bw()
```

### EDSM 2018-19 Phase 1 Strata (Equivalent to 2019-2020 Phase 1 Strata)

```{r REDSMStrata1819P1}
ggplot(R_EDSM_Strata_1819P1)+
  geom_sf(aes(fill=Stratum))+
  theme_bw()
```

### EDSM 2019 Phase 3 Strata

```{r REDSMStrata19P3}
ggplot(R_EDSM_Strata_19P3)+
  geom_sf(aes(fill=Stratum))+
  theme_bw()
```


## Subregions

### EDSM 2016-17 Phase 1 Subregions (Equivalent to 2017 Phase 3 Subregions)

```{r REDSMSubregions1617P1}
ggplot(R_EDSM_Subregions_1617P1)+
  geom_sf(aes(fill=SubRegion))+
  theme_bw()+
  theme(legend.position="none")
```

### EDSM 2017 Phase 2 Subregions

```{r REDSMSubregions17P2}
ggplot(R_EDSM_Subregions_17P2)+
  geom_sf(aes(fill=SubRegion))+
  theme_bw()+
  theme(legend.position="none")
```

### EDSM 2017-18 Phase 1 Subregions

```{r REDSMSubregions1718P1}
ggplot(R_EDSM_Subregions_1718P1)+
  geom_sf(aes(fill=SubRegion))+
  theme_bw()+
  theme(legend.position="none")
```

### EDSM 2018 Phases 2-3 Subregions (Equivalent to 2019 Phase 2 and 2020 Phase 2-3 Subregions)

```{r REDSMSubregions18P23}
ggplot(R_EDSM_Subregions_18P23)+
  geom_sf(aes(fill=SubRegion))+
  theme_bw()+
  theme(legend.position="none")
```

### EDSM 2018-19 Phase 1 Subregions (Equivalent to 2019-2020 Phase 1 Subregions)

```{r REDSMSubregions1819P1}
ggplot(R_EDSM_Subregions_1819P1)+
  geom_sf(aes(fill=SubRegion))+
  theme_bw()+
  theme(legend.position="none")
```

### EDSM 2019 Phase 3 Subregions

```{r REDSMSubregions19P3}
ggplot(R_EDSM_Subregions_19P3)+
  geom_sf(aes(fill=SubRegion))+
  theme_bw()+
  theme(legend.position="none")
```

### Brian Mahardja's edited EDSM subregions

```{r REDSMSubregionsMahardja}
ggplot(R_EDSM_Subregions_Mahardja)+
  geom_sf(aes(fill=SubRegion))+
  theme_bw()+
  theme(legend.position="none")
```

### Modified version of Brian Mahardja's edited EDSM subregions 

This version was created for use by the IEP FLOAT/Drought MAST analyses in 2021. The "Georgiana Slough" and "Sacramento River near Ryde" SubRegions were merged, retaining the "Sacramento River near Ryde" name.

```{r REDSMSubregionsMahardjaFLOAT}
ggplot(R_EDSM_Subregions_Mahardja_FLOAT)+
  geom_sf(aes(fill=SubRegion))+
  theme_bw()+
  theme(legend.position="none")
```

### SubRegions from the Delta Smelt individual based model

This shapefile was created by Flow West, Rose et al. 2013, and Peterson et al. 2019.
Peterson, J., E. McCreless, A. Duarte, S. Hamilton, and J. Medellin-Azuara. 2019. Structured Decision Making for Scientific Management in the San Francisco Bay-Delta. Draft progress report, US Bureau of Reclamation, Sacramento, CA. Data available on: https://github.com/CSAMP/delta-secchi-temperature-data.
Rose, K. A., W. J. Kimmerer, K. P. Edwards, and W. A. Bennett. 2013. Individual-Based Modeling of Delta Smelt Population Dynamics in the Upper San Francisco Estuary: I. Model Description and Baseline Results. Transactions of the American Fisheries Society 142:1238â€“1259.

```{r}
ggplot(R_DSIBM)+
  geom_sf(aes(fill=SUBREGION))+
  theme_bw()+
  theme(legend.position="none")
```

# Habitat

## California aquatic resources inventory

San Francisco Estuary Institute (SFEI). 2017. "California Aquatic Resource Inventory (CARI) version 0.3." Accessed Aug 26, 2020. http://www.sfei.org/data/california-aquatic-resource-inventory-cari-version-03-gis-data

### CARI wetlands

```{r HCARIwetlands, fig.height=12}
ggplot(H_CARI_wetlands) +
  geom_sf(aes(fill = leglabellevel1))+
  scale_fill_discrete(name="Wetland type", guide=guide_legend(ncol=1, title.position = "top", label.theme=element_text(size=8)))+
  theme_bw()+
  theme(legend.position = "bottom")
```

### CARI streams

```{r HCARIstreams}
ggplot(H_CARI_streams) +
  geom_sf()+
  theme_bw()
```

# Point data

## Stations from IEP's long term monitoring surveys

These data were collated from the discretewq package, zooper package, and other IEP data published on EDI. Code was modified from:
https://github.com/sbashevkin/stations

This file only reflects stations that are active or have been active recently (2015-2021). You can visualize stations by year here: https://deltascience.shinyapps.io/monitoring/ 

### Stations

```{r Stations, fig.height=12}
ggplot() +
  geom_sf(data = WW_Delta)+
  geom_sf(data = P_Stations, aes(color = Source))+
  theme_bw()+
  theme(legend.position = "bottom")
```


## River Kilometer indexes

This shows the official river kilometer positions for the major rivers, bays, and sloughs of the San Francisco Estuary and the Delta.

### RKI

```{r RKI, fig.height=12, warning=FALSE}
P_RKI_test = subset(P_RKI, RKI/10 == round(RKI/10))

ggplot()+
  geom_sf(data = WW_Delta)+
  geom_sf_text(data = P_RKI_test, 
               aes(color = NAME, label = RKI))+
  scale_color_discrete(guide = FALSE)+
  theme_bw() + xlab(NULL)+ ylab(NULL)

```


## X2 Locations

This shows the official river kilometer positions used for the X2 index (distance from the Golden Gate).

### X2

```{r X2, fig.height=12, warning=FALSE}

P_X2_test = subset(P_X2, RKI/10 == round(RKI/10))

ggplot()+
  geom_sf(data = WW_Delta)+
  geom_sf_text(data = P_X2_test, 
               aes( label = RKI))+
  scale_color_discrete(guide = "none")+
  theme_bw() + xlab(NULL)+ ylab(NULL)

```
